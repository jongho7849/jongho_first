import streamlit as st

# ==============================
#  ê¸°ë³¸ ì¶”ì²œ ë¡œì§ í•¨ìˆ˜ë“¤
# ==============================

def detect_cluster(middle_school: str) -> str:
    """ì¤‘í•™êµ ì´ë¦„ì„ ê¸°ë°˜ìœ¼ë¡œ ê¶Œì—­ í´ëŸ¬ìŠ¤í„° ë¶„ë¥˜"""
    if not middle_school:
        return ""

    ms = middle_school.strip()

    # ë¶ë©´/ë™ìê¶Œ -> ë¬¸ì„±ê³  ì¤‘ì‹¬
    north_keywords = ["ë¶ë©´", "ë™ì"]
    if any(k in ms for k in north_keywords):
        return "north"

    # ë§ˆì‚° í•µì‹¬ê¶Œ -> ë§ˆì‚°ê³ /ë§ˆì‚°ì—¬ê³ 
    masan_keywords = ["ì–‘ë•", "ì„ì „", "í•©ì„±", "íšŒì›", "ë‚´ì„œ", "ì›”ì˜", "ìì‚°", "ì˜¤ë™"]
    if any(k in ms for k in masan_keywords):
        return "masan_core"

    # ì˜ì°½ í•µì‹¬ê¶Œ -> ì¤‘ì•™/ì‚¬íŒŒ
    uichang_keywords = ["ìš©ì§€", "íŒ”ìš©", "ëª…ì„œ", "ì°½ì›ì¤‘"]
    if any(k in ms for k in uichang_keywords):
        return "uichang_core"

    # ì„±ì‚° í•µì‹¬ê¶Œ -> ë‚¨ê³ /ëª…ì§€ì—¬
    seongsan_keywords = ["ìƒë‚¨", "ì‚¬íŒŒ", "ë°˜ì†¡", "ì„±ì£¼", "ìš©í˜¸"]
    if any(k in ms for k in seongsan_keywords):
        return "seongsan_core"

    # ì§„í•´ í•µì‹¬ê¶Œ (ì˜ˆ: í’í˜¸, ì—¬ì¢Œ, ë³‘ì•” ë“±)
    jinhae_keywords = ["í’í˜¸", "ì—¬ì¢Œ", "ë³‘ì•”", "ì§„í•´"]
    if any(k in ms for k in jinhae_keywords):
        return "jinhae_core"

    return ""  # íŠ¹ë³„ í´ëŸ¬ìŠ¤í„° ì—†ìŒ


def base_first_choice(s_type: str, score: float, zone: str) -> str:
    """ì¤‘í•™êµ í´ëŸ¬ìŠ¤í„°ê°€ ì—†ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” 1ì§€ë§ ê¸°ë³¸ ë¡œì§"""
    if s_type == "íƒêµ¬í˜•":
        if score >= 90:
            if zone == "ì˜ì°½":
                return "ì°½ì›ì¤‘ì•™ê³ "
            elif zone == "ì„±ì‚°":
                return "ì°½ì›ë‚¨ê³ "
            elif zone == "ë§ˆì‚°":
                return "ë§ˆì‚°ê³ "
            elif zone == "ì§„í•´":
                return "ì§„í•´ê³ "
        elif score >= 85:
            if zone == "ì˜ì°½":
                return "ì°½ì›ì¤‘ì•™ê³ "
            elif zone == "ì„±ì‚°":
                return "ì°½ì›ë‚¨ê³ "
            elif zone == "ë§ˆì‚°":
                return "ë§ˆì‚°ê³ "
            elif zone == "ì§„í•´":
                return "ì§„í•´ê³ "
        # 85ì  ë¯¸ë§Œ
        if zone in ["ì˜ì°½", "ì„±ì‚°"]:
            return "ì‚¬íŒŒê³ "
        elif zone == "ë§ˆì‚°":
            return "ë§ˆì‚°ê³ "
        elif zone == "ì§„í•´":
            return "ì§„í•´ê³ "

    elif s_type == "ì•ˆì •í˜•":
        if zone in ["ì˜ì°½", "ì„±ì‚°"]:
            return "ì‚¬íŒŒê³ "
        elif zone == "ë§ˆì‚°":
            return "ë¬¸ì„±ê³ "
        elif zone == "ì§„í•´":
            return "ì§„í•´ê³ "

    elif s_type == "ë„ì „í˜•":
        if zone == "ì˜ì°½":
            return "ì°½ì›ì¤‘ì•™ê³ "
        elif zone == "ì„±ì‚°":
            return "ì°½ì›ë‚¨ê³ "
        elif zone == "ë§ˆì‚°":
            return "ë§ˆì‚°ê³ "
        elif zone == "ì§„í•´":
            return "ì§„í•´ê³ "

    return ""


def base_second_choice(s_type: str, score: float, zone: str) -> str:
    """ì¤‘í•™êµ í´ëŸ¬ìŠ¤í„°ê°€ ì—†ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” 2ì§€ë§ ê¸°ë³¸ ë¡œì§"""
    if s_type == "íƒêµ¬í˜•":
        if zone == "ì˜ì°½":
            return "ì°½ì›ë‚¨ê³ "
        elif zone == "ì„±ì‚°":
            return "ì°½ì›ì¤‘ì•™ê³ "
        elif zone == "ë§ˆì‚°":
            return "ì°½ì›ì¤‘ì•™ê³ "
        elif zone == "ì§„í•´":
            return "ì§„í•´ì—¬ê³ "

    elif s_type == "ì•ˆì •í˜•":
        if zone in ["ì˜ì°½", "ì„±ì‚°"]:
            return "ë¬¸ì„±ê³ "
        elif zone == "ë§ˆì‚°":
            return "ì‚¬íŒŒê³ "
        elif zone == "ì§„í•´":
            return "ì§„í•´ì—¬ê³ "

    elif s_type == "ë„ì „í˜•":
        if zone == "ì˜ì°½":
            return "ì°½ì›ë‚¨ê³ "
        elif zone == "ì„±ì‚°":
            return "ì°½ì›ì¤‘ì•™ê³ "
        elif zone == "ë§ˆì‚°":
            return "ì°½ì›ì¤‘ì•™ê³ "
        elif zone == "ì§„í•´":
            return "ì§„í•´ì—¬ê³ "

    return ""


def adjust_for_gender(rec_list, gender: str, zone: str):
    """ë‚¨/ì—¬ ì„ íƒ ì‹œ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ë¥¼ ì„±ë³„ì— ë§ê²Œ ì¬ì •ë ¬"""
    if gender == "ë¬´ê´€":
        return rec_list[:5]

    boys_only = ["ì°½ì›ë‚¨ê³ ", "ë§ˆì‚°ê³ ", "ì§„í•´ê³ "]
    girls_only = ["ëª…ì§€ì—¬ê³ ", "ì°½ì›ì—¬ê³ ", "ë§ˆì‚°ì—¬ê³ ", "ì§„í•´ì—¬ê³ "]

    # ë‚¨í•™ìƒ: ì—¬ê³ ëŠ” ë’¤ë¡œ ë°€ê¸°
    if gender == "ë‚¨":
        kept = [r for r in rec_list if r not in girls_only]
        girls = [r for r in rec_list if r in girls_only]
        rec_list = kept + girls

    # ì—¬í•™ìƒ: ë‚¨ê³ ëŠ” ë’¤ë¡œ ë°€ê³ , ì—¬ê³ ë¥¼ ì•ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
    elif gender == "ì—¬":
        kept = [r for r in rec_list if r not in boys_only]
        boys = [r for r in rec_list if r in boys_only]
        rec_list = kept + boys

        # ì•ë¶€ë¶„ì— ì—¬ê³ ê°€ ì „í˜€ ì—†ìœ¼ë©´ ê¶Œì—­ë³„ ëŒ€í‘œ ì—¬ê³ ë¥¼ ë§¨ ì•ì— ì¶”ê°€
        if not any(r in girls_only for r in rec_list[:2]):
            if zone in ["ì˜ì°½", "ì„±ì‚°"]:
                prefer = "ëª…ì§€ì—¬ê³ "
            elif zone == "ë§ˆì‚°":
                prefer = "ë§ˆì‚°ì—¬ê³ "
            elif zone == "ì§„í•´":
                prefer = "ì§„í•´ì—¬ê³ "
            else:
                prefer = "ì°½ì›ì—¬ê³ "

            if prefer not in rec_list:
                rec_list.insert(0, prefer)
            else:
                # ì´ë¯¸ ìˆë‹¤ë©´ ë§¨ ì•ìœ¼ë¡œ ê°€ì ¸ì˜¤ê³  ë’¤ì— ìˆëŠ” ê±´ ì œê±°
                first = True
                new_list = []
                for r in [prefer] + rec_list:
                    if r == prefer:
                        if first:
                            new_list.append(r)
                            first = False
                    else:
                        if r not in new_list:
                            new_list.append(r)
                rec_list = new_list

    return rec_list[:5]


# ------------------------------
#  í•™êµë³„ ìƒì„¸ íŠ¹ì§•(í”„ë¡œí•„)
# ------------------------------

SCHOOL_PROFILES = {
    "ì°½ì›ì¤‘ì•™ê³ ": [
        "ì˜ì°½êµ¬ ìƒìœ„ê¶Œ ì¼ë°˜ê³ ë¡œ, ë‚´ì‹  ê²½ìŸì´ ë¹„êµì  ì¹˜ì—´í•œ í¸ì…ë‹ˆë‹¤.",
        "ìˆ˜ì‹œÂ·ì •ì‹œë¥¼ í•¨ê»˜ ì¤€ë¹„í•˜ëŠ” í•™ì—… ì¤‘ì‹¬ ë¶„ìœ„ê¸°ê°€ ê°•í•©ë‹ˆë‹¤.",
        "íŒ”ìš©Â·ìš©ì§€Â·ëª…ì„œê¶Œ ì¤‘í•™êµ í•™ìƒë“¤ì˜ ì„ í˜¸ë„ê°€ ë†’ì€ í•™êµì…ë‹ˆë‹¤.",
    ],
    "ì°½ì›ë‚¨ê³ ": [
        "ì„±ì‚°êµ¬ ëŒ€í‘œ ë‚¨ì ìƒìœ„ê¶Œ ì¼ë°˜ê³ ë¡œ, í•™ì—…Â·í•™ìƒíšŒ í™œë™ì´ ëª¨ë‘ í™œë°œí•œ í¸ì…ë‹ˆë‹¤.",
        "ìƒë‚¨Â·ì‚¬íŒŒÂ·ìš©í˜¸ê¶Œ í•™ìƒë“¤ì—ê²Œ í†µí•™ì´ ìœ ë¦¬í•œ í¸ì…ë‹ˆë‹¤.",
        "ìˆ˜ëŠ¥ ëŒ€ë¹„ ì§‘ì¤‘ ê´€ë¦¬ì™€ ììœ¨í•™ìŠµ ë¬¸í™”ê°€ í˜•ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.",
    ],
    "ë§ˆì‚°ê³ ": [
        "ë§ˆì‚°ê¶Œ ì „í†µ ìˆëŠ” ë‚¨ì ì¼ë°˜ê³ ë¡œ, ì§€ì—­ ìƒìœ„ê¶Œ í•™ìƒì´ ë§ì´ ì§„í•™í•©ë‹ˆë‹¤.",
        "ì–‘ë•Â·í•©ì„±Â·íšŒì›Â·ë‚´ì„œ ë“± ë§ˆì‚° í•µì‹¬ê¶Œ ì¤‘í•™êµì—ì„œ ì§„í•™ ë¹„ìœ¨ì´ ë†’ìŠµë‹ˆë‹¤.",
        "ìˆ˜ëŠ¥ ì¤‘ì‹¬ ì§„í•™ì„ ì¤€ë¹„í•˜ëŠ” í•™ìƒ ë¹„ì¤‘ì´ ë†’ì€ í¸ì…ë‹ˆë‹¤.",
    ],
    "ëª…ì§€ì—¬ê³ ": [
        "ì„±ì‚°Â·ì˜ì°½ê¶Œ ì—¬í•™ìƒë“¤ì´ ë§ì´ ì§€ì›í•˜ëŠ” ìƒìœ„ê¶Œ ì—¬ê³ ì…ë‹ˆë‹¤.",
        "ë‚´ì‹ Â·ë¹„êµê³¼ë¥¼ ê· í˜• ìˆê²Œ ê´€ë¦¬í•˜ë©° í•™ìƒë¶€ì¢…í•© ëŒ€ë¹„ì— ìœ ë¦¬í•œ í¸ì…ë‹ˆë‹¤.",
        "ìƒë‚¨Â·ì‚¬íŒŒÂ·ìš©í˜¸Â·ìš©ì§€ ì¼ëŒ€ì—ì„œ í†µí•™ ì ‘ê·¼ì„±ì´ ì¢‹ìŠµë‹ˆë‹¤.",
    ],
    "ì°½ì›ì—¬ê³ ": [
        "ì°½ì› ì „ì—­ì—ì„œ ì—¬í•™ìƒì´ ì§€ì›í•˜ëŠ” ì¼ë°˜ ì—¬ê³ ì…ë‹ˆë‹¤.",
        "ë‚´ì‹  ë¶€ë‹´ì„ ê³¼ë„í•˜ê²Œ ë†’ì´ì§€ ì•Šìœ¼ë©´ì„œë„ ìƒìœ„ê¶Œ ì§„í•™ì„ ë…¸ë ¤ë³¼ ìˆ˜ ìˆëŠ” í¸ì…ë‹ˆë‹¤.",
        "ì¤‘ìœ„ê¶Œ~ìƒìœ„ê¶Œ ì—¬í•™ìƒì´ ì•ˆì •ì ìœ¼ë¡œ ì§„í•™ ì „ëµì„ ì„¸ìš°ê¸°ì— ì í•©í•©ë‹ˆë‹¤.",
    ],
    "ë§ˆì‚°ì—¬ê³ ": [
        "ë§ˆì‚°ê¶Œ ëŒ€í‘œ ì—¬ê³ ë¡œ, ë§ˆì‚°Â·ì§„í•´ê¶Œ ì—¬í•™ìƒë“¤ì—ê²Œ ì„ íƒ í­ì„ ë„“í˜€ì£¼ëŠ” í•™êµì…ë‹ˆë‹¤.",
        "ë‚´ì‹  ê´€ë¦¬ì™€ í•™êµìƒí™œì˜ ê· í˜•ì„ ì›í•˜ëŠ” í•™ìƒì—ê²Œ ì í•©í•©ë‹ˆë‹¤.",
        "ë§ˆì‚°ê³ Â·ë¬¸ì„±ê³  ë“±ê³¼ í•¨ê»˜ ë§ˆì‚°ê¶Œ ì§€ë§ ì¡°í•©ì— ìì£¼ í¬í•¨ë˜ëŠ” í•™êµì…ë‹ˆë‹¤.",
    ],
    "ì§„í•´ê³ ": [
        "ì§„í•´ê¶Œ ëŒ€í‘œ ë‚¨ì ì¼ë°˜ê³ ë¡œ, ì§€ì—­ ê±°ì£¼ í•™ìƒì—ê²Œ í†µí•™ì´ ê°€ì¥ ìœ ë¦¬í•©ë‹ˆë‹¤.",
        "ì§€ì—­ ë°€ì°©í˜• í•™êµë¡œ, í†µí•™ í”¼ë¡œë„ë¥¼ ì¤„ì´ê³  í•™ì—…ì— ì§‘ì¤‘í•˜ê¸° ì¢‹ì€ í¸ì…ë‹ˆë‹¤.",
        "ì§„í•´Â·ê²½ê³„ ì§€ì—­ ì¤‘í•™êµ í•™ìƒë“¤ì˜ 1Â·2ì§€ë§ì— ìì£¼ í¬í•¨ë©ë‹ˆë‹¤.",
    ],
    "ì§„í•´ì—¬ê³ ": [
        "ì§„í•´ê¶Œ ì—¬í•™ìƒì˜ ì£¼ìš” ì„ íƒì§€ë¡œ, ì§„í•´ê¶Œ ë‚´ì‹  ê´€ë¦¬ì— ìœ ë¦¬í•œ í•™êµì…ë‹ˆë‹¤.",
        "í†µí•™ ê±°ë¦¬Â·ìƒí™œ íŒ¨í„´ì„ ì•ˆì •ì ìœ¼ë¡œ ê°€ì ¸ê°€ê³  ì‹¶ì€ í•™ìƒì—ê²Œ ì í•©í•©ë‹ˆë‹¤.",
        "ì§„í•´ê³ ì™€ í•¨ê»˜ ì§„í•´ê¶Œ ì¡°í•©(ë‚¨Â·ì—¬)ì„ êµ¬ì„±í•  ë•Œ ìì£¼ í™œìš©ë©ë‹ˆë‹¤.",
    ],
    "ì‚¬íŒŒê³ ": [
        "ì˜ì°½Â·ì„±ì‚° ê²½ê³„ì—ì„œ í†µí•™ì„±ì´ ì¢‹ê³ , ë‚´ì‹  ê´€ë¦¬ì— ìœ ë¦¬í•œ í¸ì¸ ì¼ë°˜ê³ ì…ë‹ˆë‹¤.",
        "ìƒìœ„ê¶Œ ë„ì „ë³´ë‹¤ëŠ” ì•ˆì •ì ì¸ ë‚´ì‹ ê³¼ í•™êµìƒí™œì„ ìš°ì„ í•˜ëŠ” í•™ìƒì—ê²Œ ì í•©í•©ë‹ˆë‹¤.",
        "ì°½ì›ì¤‘ì•™ê³ Â·ì°½ì›ë‚¨ê³ ì™€ í•¨ê»˜ ì¡°í•©í•  ë•Œ ì•ˆì „ ì§€ë§ ì—­í• ì„ í•©ë‹ˆë‹¤.",
    ],
    "ë¬¸ì„±ê³ ": [
        "ë§ˆì‚°ê¶ŒÂ·ì˜ì°½ê¶Œ í•™ìƒ ëª¨ë‘ì—ê²Œ ì„ íƒ ê°€ëŠ¥í•œ ì¼ë°˜ê³ ì…ë‹ˆë‹¤.",
        "ë‚´ì‹  ë‚œë„ê°€ ìƒëŒ€ì ìœ¼ë¡œ ê³¼ë„í•˜ì§€ ì•Šì•„ ì¤‘ìƒìœ„ê¶Œ í•™ìƒì—ê²Œ ì•ˆì • ì§€ë§ì´ ë©ë‹ˆë‹¤.",
        "ì‚¬íŒŒê³ ì™€ í•¨ê»˜ â€˜ì•ˆì • ì¡°í•©â€™ìœ¼ë¡œ ë°°ì¹˜í•˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.",
    ],
    "ì‹ ì›”ê³ ": [
        "í†µí•™ê³¼ í•™ì—… ë¶€ë‹´ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•œ ì•ˆì „ ì§€ë§ ì—­í• ì„ í•˜ëŠ” ì¼ë°˜ê³ ì…ë‹ˆë‹¤.",
        "ì¤‘ìœ„ê¶Œ í•™ìƒì´ ì—¬ìœ  ìˆê²Œ í•™êµìƒí™œì„ ìœ ì§€í•˜ë©´ì„œ ì§„ë¡œë¥¼ íƒìƒ‰í•˜ê¸°ì— ì í•©í•©ë‹ˆë‹¤.",
        "ìƒìœ„ ì§€ë§ì—ì„œ ë³€ìˆ˜ê°€ ë°œìƒí–ˆì„ ë•Œë¥¼ ëŒ€ë¹„í•œ â€˜ë³´í—˜ ì§€ë§â€™ ì„±ê²©ì´ ê°•í•©ë‹ˆë‹¤.",
    ],
}


def school_profile(school: str):
    """í•™êµë³„ ì£¼ìš” íŠ¹ì§• ë¦¬ìŠ¤íŠ¸ ë°˜í™˜"""
    if school in SCHOOL_PROFILES:
        return SCHOOL_PROFILES[school]
    # ë“±ë¡í•˜ì§€ ì•Šì€ í•™êµì— ëŒ€í•œ ê¸°ë³¸ ì„¤ëª…
    return [
        "í•´ë‹¹ ê¶Œì—­ì—ì„œ í†µí•™ê³¼ ë‚´ì‹  ì•ˆì •ì„±ì„ ê³ ë ¤í•´ ë°°ì¹˜í•œ ì¼ë°˜ê³ ì…ë‹ˆë‹¤.",
        "êµ¬ì²´ì ì¸ ì •ë³´ëŠ” í•™êµ í™ˆí˜ì´ì§€ ë° êµìœ¡ì²­ ìë£Œë¥¼ í•¨ê»˜ ì°¸ê³ í•˜ì‹œëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.",
    ]


def school_reason_brief(school: str) -> str:
    """í•œ ì¤„ ìš”ì•½ìš© ì§§ì€ ì‚¬ìœ """
    top_schools = ["ì°½ì›ì¤‘ì•™ê³ ", "ì°½ì›ë‚¨ê³ ", "ë§ˆì‚°ê³ ", "ëª…ì§€ì—¬ê³ ", "ì°½ì›ì—¬ê³ ", "ë§ˆì‚°ì—¬ê³ ", "ì§„í•´ê³ ", "ì§„í•´ì—¬ê³ "]
    balance_schools = ["ì‚¬íŒŒê³ ", "ë¬¸ì„±ê³ "]
    safe_schools = ["ì‹ ì›”ê³ "]

    if school in top_schools:
        return "ì§€ì—­ ìƒìœ„ê¶Œ ì¼ë°˜ê³ ë¡œ, ì„±ì ê³¼ ì„±ì¥ ê°€ëŠ¥ì„±ì„ ê³ ë ¤í•œ ë„ì „ ì§€ë§ì…ë‹ˆë‹¤."
    if school in balance_schools:
        return "ë‚´ì‹  ê´€ë¦¬ì™€ íƒêµ¬ ê³¼ëª© ì„ íƒì˜ ê· í˜•ì´ ì¢‹ì•„ ì•ˆì •ì ìœ¼ë¡œ ì„±ì ì„ ìœ ì§€í•˜ê¸° ì¢‹ì€ í•™êµì…ë‹ˆë‹¤."
    if school in safe_schools:
        return "í†µí•™ê³¼ í•™ì—… ë¶€ë‹´ì„ ê³ ë ¤í•œ ì•ˆì „ ì§€ë§ìœ¼ë¡œ, ì—¬ìœ  ìˆê²Œ í•™êµ ìƒí™œì„ í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤."
    return "í•´ë‹¹ ê¶Œì—­ì—ì„œ í†µí•™ê³¼ ë‚´ì‹  ì•ˆì •ì„±ì„ ê³ ë ¤í•´ ë°°ì¹˜í•œ ì¼ë°˜ê³ ì…ë‹ˆë‹¤."


def recommend_schools(
    name: str,
    middle_school: str,
    s_type: str,
    score: float,
    zone: str,
    gender: str,
):
    """
    ì§€ë§ 1~5 ì¶”ì²œ + ê¸°ì¤€ ì„¤ëª…
    gender: "ë¬´ê´€" / "ë‚¨" / "ì—¬"
    """

    cluster = detect_cluster(middle_school)
    rec1 = ""
    rec2 = ""
    rec3 = ""
    rec4 = ""
    rec5 = ""

    # 1ì§€ë§: ì¤‘í•™êµ í´ëŸ¬ìŠ¤í„° ìš°ì„  + ê¸°ë³¸ë¡œì§ ë³´ì™„
    if cluster == "north":
        rec1 = "ë¬¸ì„±ê³ "
    elif cluster == "masan_core":
        rec1 = "ë§ˆì‚°ê³ "
    elif cluster == "uichang_core":
        rec1 = "ì°½ì›ì¤‘ì•™ê³ "
    elif cluster == "seongsan_core":
        rec1 = "ì°½ì›ë‚¨ê³ "
    elif cluster == "jinhae_core":
        rec1 = "ì§„í•´ê³ "
    else:
        rec1 = base_first_choice(s_type, score, zone)

    # 2ì§€ë§: í´ëŸ¬ìŠ¤í„°ë³„ 2ìˆœìœ„ + ê¸°ë³¸ë¡œì§
    if cluster == "north":
        rec2 = "ì°½ì›ì¤‘ì•™ê³ "
    elif cluster == "masan_core":
        rec2 = "ë§ˆì‚°ì—¬ê³ "
    elif cluster == "uichang_core":
        rec2 = "ì‚¬íŒŒê³ "
    elif cluster == "seongsan_core":
        rec2 = "ëª…ì§€ì—¬ê³ "
    elif cluster == "jinhae_core":
        rec2 = "ì§„í•´ì—¬ê³ "
    else:
        rec2 = base_second_choice(s_type, score, zone)

    # 3,4,5ì§€ë§: í†µí•™êµ¬ì—­ ê¸°ë°˜ ì•ˆì • ì¡°í•©
    if zone in ["ì˜ì°½", "ì„±ì‚°"]:
        rec3 = "ì‚¬íŒŒê³ "
        rec4 = "ë¬¸ì„±ê³ "
        rec5 = "ì‹ ì›”ê³ "
    elif zone == "ë§ˆì‚°":
        rec3 = "ë¬¸ì„±ê³ "
        rec4 = "ì‚¬íŒŒê³ "
        rec5 = "ë§ˆì‚°ì—¬ê³ "
    elif zone == "ì§„í•´":
        rec3 = "ì§„í•´ê³ "
        rec4 = "ì§„í•´ì—¬ê³ "
        rec5 = "ì§„í•´ê³ "

    # ì¤‘ë³µ ì œê±°
    rec_list = []
    for r in [rec1, rec2, rec3, rec4, rec5]:
        if r and r not in rec_list:
            rec_list.append(r)

    # ë‚¨/ì—¬ ì„ íƒ ë°˜ì˜
    rec_list = adjust_for_gender(rec_list, gender, zone)

    # í•™êµë³„ ê°„ë‹¨ ì‚¬ìœ  ë° ìƒì„¸ íŠ¹ì§• ìƒì„±
    brief_reasons = [school_reason_brief(s) for s in rec_list]
    profiles = [school_profile(s) for s in rec_list]

    # ìš”ì•½ ê¸°ì¤€ ì„¤ëª…
    cluster_map = {
        "north": "ë¶ë©´Â·ë™ì ë¶ì¸¡ ê¶Œì—­",
        "masan_core": "ë§ˆì‚°(ì–‘ë•Â·ì„ì „Â·í•©ì„±Â·íšŒì›Â·ë‚´ì„œ ë“±) í•µì‹¬ê¶Œ",
        "uichang_core": "ì˜ì°½(ìš©ì§€Â·íŒ”ìš©Â·ëª…ì„œÂ·ì°½ì›ì¤‘ ì¸ê·¼) í•µì‹¬ê¶Œ",
        "seongsan_core": "ì„±ì‚°(ìƒë‚¨Â·ì‚¬íŒŒÂ·ë°˜ì†¡Â·ì„±ì£¼Â·ìš©í˜¸ ì¸ê·¼) í•µì‹¬ê¶Œ",
        "jinhae_core": "ì§„í•´ í•µì‹¬ê¶Œ",
        "": "ì¼ë°˜ê¶Œ"
    }
    cluster_desc = cluster_map.get(cluster, "ì¼ë°˜ê¶Œ")

    summary_lines = []
    summary_lines.append(f"- ì¤‘í•™êµ: **{middle_school}** (ê¶Œì—­: {cluster_desc})")
    summary_lines.append(f"- í†µí•™êµ¬ì—­: **{zone}**, ì„±í–¥: **{s_type}**, ë‚´ì‹ : **{score:.1f}ì **")
    if gender != "ë¬´ê´€":
        summary_lines.append(f"- ì„±ë³„: **{gender} í•™ìƒ ê¸°ì¤€**ìœ¼ë¡œ ë‚¨ë…€ê³ /ì—¬ê³ ë¥¼ ìš°ì„  ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.")
    summary_lines.append("- 1Â·2ì§€ë§ì€ ì¤‘í•™êµ ê¶Œì—­ê³¼ ì„±í–¥Â·ë‚´ì‹ ì„ ë°˜ì˜í•´ ìƒìœ„/ë„ì „ í•™êµ ìœ„ì£¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.")
    summary_lines.append("- 3~5ì§€ë§ì€ í†µí•™ê±°ë¦¬ì™€ ë‚´ì‹  ì•ˆì •ì„±ì„ ê³ ë ¤í•œ ì•ˆì „ ì§€ë§ ìœ„ì£¼ë¡œ ë°°ì¹˜í–ˆìŠµë‹ˆë‹¤.")

    summary_text = "\n".join(summary_lines)

    return rec_list[:5], brief_reasons[:5], profiles[:5], summary_text


# ==============================
#  Streamlit UI
# ==============================

def main():
    # ğŸ”¹ ì—¬ê¸° í•™ì› ì´ë¦„ ë°”ê¾¸ê¸°
    ACADEMY_NAME = "â—‹â—‹ì˜ì–´ìˆ˜í•™í•™ì› (ì°½ì› ê³ ì…ì»¨ì„¤íŒ…)"

    st.set_page_config(page_title="ì°½ì› ê³ ì… ì§€ë§ ìë™ ì¶”ì²œê¸°", layout="centered")

    st.title("ì°½ì› ê³ ì… ì§€ë§ ìë™ ì¶”ì²œê¸°")
    st.markdown(f"#### {ACADEMY_NAME}")

    st.write("ì¤‘í•™êµ, ì„±í–¥, ë‚´ì‹ , í†µí•™êµ¬ì—­, ì„±ë³„(ì„ íƒ)ì„ ì…ë ¥í•˜ë©´, ì°½ì›Â·ë§ˆì‚°Â·ì§„í•´ ì‹¤ì œ ì§„í•™ íë¦„ì„ ë°˜ì˜í•˜ì—¬ ì§€ë§ 1~5ë¥¼ ìë™ìœ¼ë¡œ ì¶”ì²œí•©ë‹ˆë‹¤.")
    st.caption("â€» ë³¸ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©°, ìµœì¢… ë°°ì •ì€ ê²½ë‚¨êµìœ¡ì²­ ê³ ì… ë°°ì • ê¸°ì¤€ê³¼ í•´ë‹¹ ì—°ë„ ê²½ìŸ ìƒí™©ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")

    st.markdown("---")

    col1, col2 = st.columns(2)
    with col1:
        name = st.text_input("í•™ìƒ ì´ë¦„", value="ì˜ˆì‹œí•™ìƒA")
        middle_school = st.text_input("ì¤‘í•™êµ ì´ë¦„", value="ìš©ì§€ì¤‘")
        s_type = st.selectbox("ì„±í–¥ ì„ íƒ", ["íƒêµ¬í˜•", "ì•ˆì •í˜•", "ë„ì „í˜•"])
        gender_sel = st.selectbox("ì„±ë³„ ì„ íƒ (ì„ íƒ ì‚¬í•­)", ["ì„ íƒ ì•ˆ í•¨", "ë‚¨", "ì—¬"])
    with col2:
        score = st.number_input("ë‚´ì‹  í‰ê·  ì ìˆ˜ (ì˜ˆ: 87)", min_value=0.0, max_value=100.0, value=93.0, step=0.5)
        zone = st.selectbox("í†µí•™êµ¬ì—­", ["ì˜ì°½", "ì„±ì‚°", "ë§ˆì‚°", "ì§„í•´"])

    gender = "ë¬´ê´€" if gender_sel == "ì„ íƒ ì•ˆ í•¨" else gender_sel

    if st.button("ì§€ë§ 1~5 ì¶”ì²œ ë³´ê¸°"):
        recs, brief_reasons, profiles, summary_text = recommend_schools(
            name,
            middle_school,
            s_type,
            score,
            zone,
            gender,
        )

        if not recs:
            st.warning("ì¡°ê±´ì— ë§ëŠ” ì¶”ì²œ ì¡°í•©ì´ ì—†ìŠµë‹ˆë‹¤. ì…ë ¥ê°’ì„ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.")
        else:
            st.subheader(f"ğŸ“ {name} í•™ìƒ ì¶”ì²œ ì§€ë§ ê²°ê³¼")

            for i, (school, brief, prof_lines) in enumerate(zip(recs, brief_reasons, profiles), start=1):
                st.write(f"**{i}ì§€ë§: {school}**")
                st.caption(brief)  # í•œ ì¤„ ìš”ì•½
                for line in prof_lines:
                    st.markdown(f"- {line}")
                st.markdown("---")

            st.markdown("#### ì¶”ì²œ ê¸°ì¤€ ìš”ì•½")
            st.markdown(summary_text)
            st.caption("â€» í•™êµ íŠ¹ì§•ì€ ì¼ë°˜ì ì¸ ê²½í–¥ì„ ì •ë¦¬í•œ ê²ƒìœ¼ë¡œ, êµ¬ì²´ì ì¸ ì •ë³´ëŠ” ê° í•™êµ í™ˆí˜ì´ì§€ì™€ êµìœ¡ì²­ ìë£Œë¥¼ í•¨ê»˜ ì°¸ê³ í•˜ì‹œëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.")


if __name__ == "__main__":
    main()
